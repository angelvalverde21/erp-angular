@if(loading){
<app-loading></app-loading>
}@else{


<app-head-page title="Editar Produccion">
    <app-button-link [path]="['../create']">+ Crear Otra Produccion</app-button-link>
</app-head-page>

<app-manufacture-edit [manufacture]="manufacture"></app-manufacture-edit>

<app-manufacture-widgets [widget]="widget"></app-manufacture-widgets>


<div ngbAccordion [closeOthers]="true">

    <div ngbAccordionItem [collapsed]="false">
        <h2 ngbAccordionHeader>
            <button ngbAccordionButton>
                <span><fa-icon [icon]="faBagShopping" class="me-2"></fa-icon>Insumos</span>
            </button>
        </h2>
        <div ngbAccordionCollapse>
            <div ngbAccordionBody>

                <ng-template>
                    <div class="bg-white py-3 d-flex justify-content-between align-items-center">
                        <span class="ms-3"><fa-icon [icon]="faBagShopping" class="me-2"></fa-icon> Lista de compras
                            ({{
                            purchases?.length
                            }})</span>
                        <app-button-add (click)="openVerticallyCentered(content)" class="me-3">Agregar</app-button-add>

                    </div>

                    <app-purchase-index [purchases]="purchases" purchaseable_type="manufacture"
                        [purchaseable_id]="manufacture.id"></app-purchase-index>
                </ng-template>

            </div>
        </div>
    </div>


    <div ngbAccordionItem>
        <h2 ngbAccordionHeader>
            <button ngbAccordionButton>
                <span><fa-icon [icon]="faBarcode" class="me-2"></fa-icon>Productos (Corte)</span>
            </button>
        </h2>
        <div ngbAccordionCollapse>
            <div ngbAccordionBody>
                <ng-template>

                    <div class="bg-white py-3 d-flex justify-content-between align-items-center">
                        <span class="ms-3"><fa-icon [icon]="faBarcode" class="me-2"></fa-icon> Productos
                            ({{
                            purchases?.length
                            }})</span>

                        <app-button-add (click)="openVerticallyCentered(content2)" class="mb-3">Agregar
                            Productos</app-button-add>

                    </div>

                    <app-manufacture-variant-index
                        [manufacture_variants]="manufacture_variants"></app-manufacture-variant-index>
                </ng-template>
            </div>
        </div>
    </div>

    <div ngbAccordionItem>
        <h2 ngbAccordionHeader>
            <button ngbAccordionButton>
                <span><fa-icon [icon]="faCreditCard" class="me-2"></fa-icon>Presupuesto</span>
            </button>
        </h2>
        <div ngbAccordionCollapse>
            <div ngbAccordionBody>
                <ng-template>

                    <app-payment-index [payments]="manufacture?.payments" [paymentable_type]="'manufacture'"
                        [paymentable_id]="manufacture.id"></app-payment-index>
                </ng-template>
            </div>
        </div>
    </div>

    <div ngbAccordionItem>
        <h2 ngbAccordionHeader>
            <button ngbAccordionButton>
                <span><fa-icon [icon]="faRightLeft" class="me-2"></fa-icon>Recepcion de mercaderia</span>
            </button>
        </h2>
        <div ngbAccordionCollapse>
            <div ngbAccordionBody>
                <ng-template>

                    <div class="bg-white py-3 d-flex justify-content-between align-items-center">
                        <span class="ms-3"><fa-icon [icon]="faRightLeft" class="me-2"></fa-icon>Entrega y
                            recepcion</span>

                        <app-button-add (click)="openVerticallyCentered(kardex)" class="mb-3">Agregar</app-button-add>

                    </div>

                </ng-template>
            </div>
        </div>
    </div>
</div>

<!-- Agregar Compras -->

<!-- <app-head-page title="Compras" [icon]="faBagShopping">
</app-head-page> -->


<!-- Modal -->

<ng-template #content let-modal>
    <div class="modal-header">
        <h5 class="modal-title">Registrar Compra</h5>
        <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
    </div>
    <div class="modal-body">
        <app-purchase-create purchaseable_type="manufacture" [purchaseable_id]="manufacture.id"
            (emitPurchaseCreate)="receivePurchaseCreate($event)"></app-purchase-create>
    </div>

</ng-template>

<ng-template #content2 let-modal>
    <div class="modal-header">
        <h4 class="modal-title">Buscar Variantes</h4>
        <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
    </div>
    <div class="modal-body">
        <app-variant-search (emitVariantsSelected)="receiveSelectedVariants($event)"></app-variant-search>
    </div>

</ng-template>

<ng-template #kardex let-modal>
    <div class="modal-header">
        <h4 class="modal-title">Kardex (Entrada y salida)</h4>
        <button type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss('Cross click')"></button>
    </div>
    <div class="modal-body">
        <app-manufacture-variant-index [manufacture_variants]="manufacture_variants"></app-manufacture-variant-index>
    </div>

</ng-template>

}